# GroovePush 開発計画書

## 1. サービス概要

GroovePushは、音楽制作者向けのCLIベースのバックエンド管理ツールです。

ローカルの超高速なSSD環境で制作を行い、任意のタイミングで「スナップショット」をAmazon S3に保存します。これにより、Google Driveでは難しかった「過去の特定のテイクへの復元（ロールバック）」や「プロジェクトごとの独立管理」を実現します。

## 2. アーキテクチャ設計

### 技術スタック

- **言語:** Rust (最新のStable)

- **非同期ランタイム:** `tokio`（大量の小ファイルの並列アップロード用）

- **AWS接続:** `aws-sdk-s3` (Rust用Native SDK)

- **ファイルスキャン:** `ignore` クレート（ripgrepエンジンを使用し、不要ファイルを高速除外）

- **メタデータ管理:** `rusqlite` (ローカル) + `serde_json` (S3)

- **UI:** `clap` (コマンドライン引数の解析), `indicatif` (リッチな進捗バー)


---

## 3. 主要機能とフェーズ別ロードマップ

### フェーズ 1: 高速シンクエンジン (MVP)

- **Parallel Push:** フォルダを指定すると、S3の `s3://bucket/project_name/` 直下にファイルを並列アップロード。

- **Smart Diff:** 前回のプッシュから変更があったファイルのみを検出し、転送量を削減。

- **Auto Ignore:** `.gp-ignore` ファイルを作成し、DAWの一時ファイル（`.tmp`, `Analysis Files` など）を自動除外。


### フェーズ 2: Gitライクな履歴管理

- **`gp push -m "リードボーカル録り直し"`**: アップロードと同時に、コミットメッセージをS3のタグまたはメタデータファイルとして保存。

- **`gp log`**: S3上のスナップショット履歴を一覧表示。

- **`gp checkout [timestamp]`**: 指定した時点の状態にローカルを書き換える。


### フェーズ 3: 音楽制作特化機能

- **Deduplication (重複排除)**: 複数のプロジェクトで同じサンプル（Kick.wavなど）を使用している場合、S3上では実体を1つにまとめ容量を節約。

- **WAVプレビュー生成**: アップロード時に軽量なプレビュー用MP3を自動生成（`ffmpeg-next`を利用）。


---

## 4. データ構造案（S3バケット内）

Plaintext

```
s3://groovepush-bucket/
├── .gp_global/                 # 全プロジェクト共通のハッシュ（重複排除用）
│   └── blobs/ab/12345...wav
└── Project_A/                  # プロジェクトごとのルート
    ├── .gp/                    # GroovePush管理用フォルダ
    │   ├── history.json        # コミット履歴
    │   └── current_state.json  # 現在のファイル構成（マニフェスト）
    ├── Project_A.als           # 実データ
    └── Samples/
```

---

## CLAUDEへのルール

- 作業1つごとに日本語で簡潔にgit commitする。
- 新しく覚える必要のあることはCLAUDE.mdを更新して覚える。
